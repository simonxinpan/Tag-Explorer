"use strict";(()=>{var t={};t.id=329,t.ids=[329],t.modules={145:t=>{t.exports=require("next/dist/compiled/next-server/pages-api.runtime.prod.js")},8678:t=>{t.exports=import("pg")},6249:(t,e)=>{Object.defineProperty(e,"l",{enumerable:!0,get:function(){return function t(e,n){return n in e?e[n]:"then"in e&&"function"==typeof e.then?e.then(e=>t(e,n)):"function"==typeof e&&"default"===n?e:void 0}}})},317:(t,e,n)=>{n.a(t,async(t,a)=>{try{n.r(e),n.d(e,{config:()=>m,default:()=>u,routeModule:()=>p});var c=n(1802),s=n(7153),r=n(6249),o=n(3733),i=t([o]);o=(i.then?(await i)():i)[0];let u=(0,r.l)(o,"default"),m=(0,r.l)(o,"config"),p=new c.PagesAPIRouteModule({definition:{kind:s.x.PAGES_API,page:"/api/tags",pathname:"/api/tags",bundlePath:"",filename:""},userland:o});a()}catch(t){a(t)}})},3733:(t,e,n)=>{n.a(t,async(t,a)=>{try{n.r(e),n.d(e,{default:()=>r});var c=n(8678),s=t([c]);let o=new(c=(s.then?(await s)():s)[0]).Pool({connectionString:process.env.NEON_DATABASE_URL,ssl:{rejectUnauthorized:!1}});async function r(t,e){let{symbol:n,tag_name:a}=t.query;if(!process.env.NEON_DATABASE_URL||process.env.NEON_DATABASE_URL.includes("username:password"))return function(t,e,{symbol:n,tag_name:a}){n?e.status(200).json([{name:"大盘股",type:"dynamic"},{name:"科技股",type:"dynamic"},{name:"强势上涨",type:"dynamic"}]):a?e.status(200).json([{ticker:"AAPL",name_zh:"苹果公司",change_percent:2.45},{ticker:"MSFT",name_zh:"微软公司",change_percent:1.87},{ticker:"GOOGL",name_zh:"谷歌",change_percent:3.21},{ticker:"AMZN",name_zh:"亚马逊",change_percent:-.95},{ticker:"TSLA",name_zh:"特斯拉",change_percent:4.67}]):e.status(200).json([{name:"大盘股",type:"dynamic",stock_count:45},{name:"科技股",type:"dynamic",stock_count:32},{name:"强势上涨",type:"dynamic",stock_count:28},{name:"高价股",type:"dynamic",stock_count:23},{name:"金融股",type:"dynamic",stock_count:19},{name:"医药股",type:"dynamic",stock_count:15},{name:"能源股",type:"dynamic",stock_count:12},{name:"消费股",type:"dynamic",stock_count:18},{name:"中盘股",type:"dynamic",stock_count:35},{name:"温和上涨",type:"dynamic",stock_count:22}])}(0,e,{symbol:n,tag_name:a});let c=await o.connect();try{let t;if(n){let{rows:e}=await c.query(`SELECT t.name, t.type FROM tags t
                 JOIN stock_tags st ON t.id = st.tag_id
                 WHERE st.stock_ticker = $1 ORDER BY t.type, t.name`,[n.toUpperCase()]);t=e}else if(a){let{rows:e}=await c.query(`SELECT s.ticker, s.name_zh, s.change_percent FROM stocks s
                 JOIN stock_tags st ON s.ticker = st.stock_ticker
                 JOIN tags t ON st.tag_id = t.id
                 WHERE t.name = $1 ORDER BY s.market_cap DESC NULLS LAST`,[a]);t=e}else{let{rows:e}=await c.query(`SELECT t.name, t.type, COUNT(st.stock_ticker)::int as stock_count FROM tags t
                 LEFT JOIN stock_tags st ON t.id = st.tag_id
                 GROUP BY t.id
                 HAVING COUNT(st.stock_ticker) > 0 -- 只返回有关联股票的标签
                 ORDER BY t.type, stock_count DESC, t.name`);t=e}e.setHeader("Cache-Control","s-maxage=300, stale-while-revalidate"),e.status(200).json(t)}catch(t){console.error("API /tags Error:",t),e.status(500).json({error:"Database query failed."})}finally{c&&c.release()}}a()}catch(t){a(t)}})},7153:(t,e)=>{var n;Object.defineProperty(e,"x",{enumerable:!0,get:function(){return n}}),function(t){t.PAGES="PAGES",t.PAGES_API="PAGES_API",t.APP_PAGE="APP_PAGE",t.APP_ROUTE="APP_ROUTE"}(n||(n={}))},1802:(t,e,n)=>{t.exports=n(145)}};var e=require("../../webpack-api-runtime.js");e.C(t);var n=e(e.s=317);module.exports=n})();