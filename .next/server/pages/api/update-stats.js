"use strict";(()=>{var a={};a.id=370,a.ids=[370],a.modules={4852:(a,b,c)=>{c.d(b,{W:()=>o});let d=require("fs");var e=c.n(d);let f=require("path");var g=c.n(f);let h=g().join(process.cwd(),"data"),i=g().join(h,"stocks.json"),j=g().join(h,"update_stats.json");function k(){try{if(e().existsSync(i)){let a=e().readFileSync(i,"utf8");return JSON.parse(a)}}catch(a){console.error("读取股票数据失败:",a)}return[]}function l(){try{if(e().existsSync(j)){let a=e().readFileSync(j,"utf8");return JSON.parse(a)}}catch(a){console.error("读取统计数据失败:",a)}return[]}function m(a){try{e().writeFileSync(i,JSON.stringify(a,null,2))}catch(a){console.error("写入股票数据失败:",a)}}function n(a){try{e().writeFileSync(j,JSON.stringify(a,null,2))}catch(a){console.error("写入统计数据失败:",a)}}e().existsSync(h)||e().mkdirSync(h,{recursive:!0});class o{static async getStocks(){return k()}static async updateStock(a,b){let c=k(),d=c.findIndex(b=>b.symbol===a),e={symbol:a,...b,last_updated:new Date().toISOString()};d>=0?c[d]=e:c.push(e),m(c)}static async batchUpdateStocks(a){let b=k();for(let c of a){let a=b.findIndex(a=>a.symbol===c.symbol),d={...c,last_updated:new Date().toISOString()};a>=0?b[a]=d:b.push(d)}m(b)}static async logUpdateStats(a){let b=l();b.push({id:b.length+1,...a,created_at:new Date().toISOString()}),n(b)}static async getUpdateStats(a=10){return l().sort((a,b)=>new Date(b.created_at)-new Date(a.created_at)).slice(0,a)}static async clearAll(){m([]),n([])}static async getDataStats(){let a=k(),b=new Date(new Date().getTime()-864e5),c=a.length,d=a.filter(a=>a.last_price&&void 0!==a.change_amount).length,e=a.filter(a=>a.last_updated&&new Date(a.last_updated)>b).length,f=a.filter(a=>a.tags&&a.tags.length>0).length,g=a.filter(a=>!a.last_price||void 0===a.change_amount||void 0===a.change_percent).length,h=a.filter(a=>a.last_price<=0||Math.abs(a.change_percent)>50).length;return{totalStocks:c,stocksWithData:d,recentlyUpdated:e,stocksWithTags:f,incompleteStocks:g,anomalousStocks:h,recentUpdates:await this.getUpdateStats(5),completeness:c>0?d/c*100:0,freshness:c>0?e/c*100:0,tagCoverage:c>0?f/c*100:0,dataQuality:c>0?(c-h)/c*100:0}}}},5600:a=>{a.exports=require("next/dist/compiled/next-server/pages-api.runtime.prod.js")},7710:(a,b,c)=>{c.r(b),c.d(b,{config:()=>n,default:()=>m,handler:()=>p});var d={};c.r(d),c.d(d,{default:()=>j});var e=c(9046),f=c(8667),g=c(3480),h=c(6435),i=c(4852);async function j(a,b){if("GET"!==a.method)return b.status(405).json({error:"Method not allowed"});try{let a=await i.default.getUpdateStats();b.status(200).json({success:!0,data:a})}catch(a){console.error("获取更新统计失败:",a),b.status(500).json({success:!1,error:"获取更新统计失败"})}}var k=c(8112),l=c(8766);let m=(0,h.M)(d,"default"),n=(0,h.M)(d,"config"),o=new g.PagesAPIRouteModule({definition:{kind:f.A.PAGES_API,page:"/api/update-stats",pathname:"/api/update-stats",bundlePath:"",filename:""},userland:d,distDir:".next",projectDir:""});async function p(a,b,c){let d=await o.prepare(a,b,{srcPage:"/api/update-stats"});if(!d){b.statusCode=400,b.end("Bad Request"),null==c.waitUntil||c.waitUntil.call(c,Promise.resolve());return}let{query:f,params:g,prerenderManifest:h}=d;try{let c=a.method||"GET",d=(0,k.getTracer)(),e=d.getActiveScopeSpan(),i=o.instrumentationOnRequestError.bind(o),j=async e=>o.render(a,b,{query:{...f,...g},params:g,allowedRevalidateHeaderKeys:void 0,multiZoneDraftMode:!0,trustHostHeader:void 0,previewProps:h.preview,propagateError:!1,dev:o.isDev,page:"/api/update-stats",projectDir:"",onError:(...b)=>i(a,...b)}).finally(()=>{if(!e)return;e.setAttributes({"http.status_code":b.statusCode,"next.rsc":!1});let f=d.getRootSpanAttributes();if(!f)return;if(f.get("next.span_type")!==l.BaseServerSpan.handleRequest)return void console.warn(`Unexpected root span type '${f.get("next.span_type")}'. Please report this Next.js issue https://github.com/vercel/next.js`);let g=f.get("next.route");if(g){let a=`${c} ${g}`;e.setAttributes({"next.route":g,"http.route":g,"next.span_name":a}),e.updateName(a)}else e.updateName(`${c} ${a.url}`)});e?await j(e):await d.withPropagatedContext(a.headers,()=>d.trace(l.BaseServerSpan.handleRequest,{spanName:`${c} ${a.url}`,kind:k.SpanKind.SERVER,attributes:{"http.method":c,"http.target":a.url}},j))}catch(a){if(o.isDev)throw a;(0,e.sendError)(b,500,"Internal Server Error")}finally{null==c.waitUntil||c.waitUntil.call(c,Promise.resolve())}}}};var b=require("../../webpack-api-runtime.js");b.C(a);var c=b.X(0,[169],()=>b(b.s=7710));module.exports=c})();