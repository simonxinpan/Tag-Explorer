"use strict";(()=>{var e={};e.id=329,e.ids=[329],e.modules={145:e=>{e.exports=require("next/dist/compiled/next-server/pages-api.runtime.prod.js")},8678:e=>{e.exports=import("pg")},6249:(e,t)=>{Object.defineProperty(t,"l",{enumerable:!0,get:function(){return function e(t,n){return n in t?t[n]:"then"in t&&"function"==typeof t.then?t.then(t=>e(t,n)):"function"==typeof t&&"default"===n?t:void 0}}})},1660:(e,t,n)=>{n.r(t),n.d(t,{config:()=>u,default:()=>o,routeModule:()=>m});var a={};n.r(a),n.d(a,{default:()=>i});var s=n(1802),c=n(7153),r=n(6249);async function i(e,t){let{symbol:a,tag_name:s}=e.query;if(!process.env.NEON_DATABASE_URL||process.env.NEON_DATABASE_URL.includes("username:password"))return function(e,t,{symbol:n,tag_name:a}){n?t.status(200).json([{name:"大盘股",type:"dynamic"},{name:"科技股",type:"dynamic"},{name:"强势上涨",type:"dynamic"}]):a?t.status(200).json([{ticker:"AAPL",name_zh:"苹果公司",change_percent:2.45},{ticker:"MSFT",name_zh:"微软公司",change_percent:1.87},{ticker:"GOOGL",name_zh:"谷歌",change_percent:3.21},{ticker:"AMZN",name_zh:"亚马逊",change_percent:-.95},{ticker:"TSLA",name_zh:"特斯拉",change_percent:4.67}]):t.status(200).json([{name:"大盘股",type:"dynamic",stock_count:45},{name:"科技股",type:"dynamic",stock_count:32},{name:"强势上涨",type:"dynamic",stock_count:28},{name:"高价股",type:"dynamic",stock_count:23},{name:"金融股",type:"dynamic",stock_count:19},{name:"医药股",type:"dynamic",stock_count:15},{name:"能源股",type:"dynamic",stock_count:12},{name:"消费股",type:"dynamic",stock_count:18},{name:"中盘股",type:"dynamic",stock_count:35},{name:"温和上涨",type:"dynamic",stock_count:22}])}(0,t,{symbol:a,tag_name:s});let{Pool:c}=await Promise.resolve().then(n.bind(n,8678)),r=new c({connectionString:process.env.NEON_DATABASE_URL,ssl:{rejectUnauthorized:!1}}),i=await r.connect();try{let e;if(a){let{rows:t}=await i.query(`SELECT t.name, t.type FROM tags t
                 JOIN stock_tags st ON t.id = st.tag_id
                 WHERE st.stock_ticker = $1 ORDER BY t.type, t.name`,[a.toUpperCase()]);e=t}else if(s){let{rows:t}=await i.query(`SELECT s.ticker, s.name_zh, s.change_percent FROM stocks s
                 JOIN stock_tags st ON s.ticker = st.stock_ticker
                 JOIN tags t ON st.tag_id = t.id
                 WHERE t.name = $1 ORDER BY s.market_cap DESC NULLS LAST`,[s]);e=t}else{let{rows:t}=await i.query(`SELECT t.name, t.type, COUNT(st.stock_ticker)::int as stock_count FROM tags t
                 LEFT JOIN stock_tags st ON t.id = st.tag_id
                 GROUP BY t.id
                 HAVING COUNT(st.stock_ticker) > 0 -- 只返回有关联股票的标签
                 ORDER BY t.type, stock_count DESC, t.name`);e=t}t.setHeader("Cache-Control","s-maxage=300, stale-while-revalidate"),t.status(200).json(e)}catch(e){console.error("API /tags Error:",e),t.status(500).json({error:"Database query failed."})}finally{i&&i.release()}}let o=(0,r.l)(a,"default"),u=(0,r.l)(a,"config"),m=new s.PagesAPIRouteModule({definition:{kind:c.x.PAGES_API,page:"/api/tags",pathname:"/api/tags",bundlePath:"",filename:""},userland:a})},7153:(e,t)=>{var n;Object.defineProperty(t,"x",{enumerable:!0,get:function(){return n}}),function(e){e.PAGES="PAGES",e.PAGES_API="PAGES_API",e.APP_PAGE="APP_PAGE",e.APP_ROUTE="APP_ROUTE"}(n||(n={}))},1802:(e,t,n)=>{e.exports=n(145)}};var t=require("../../webpack-api-runtime.js");t.C(e);var n=t(t.s=1660);module.exports=n})();